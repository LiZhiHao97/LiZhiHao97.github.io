

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&quot;auto&quot;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="å¤šæ€»ç»“ï¼Œå¤šæ€è€ƒ">
  <meta name="author" content="Zh">
  <meta name="keywords" content="">
  <title>React Hooksç†è§£ - Zh&#39;s Blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Zh's Blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://image-1253774868.cos.ap-nanjing.myqcloud.com/img/7.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="React Hooksç†è§£">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      Zh
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-04-08 15:17" pubdate>
        2022å¹´4æœˆ8æ—¥ ä¸‹åˆ
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.6k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      34
       åˆ†é’Ÿ
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">React Hooksç†è§£</h1>
            
            <div class="markdown-body">
              <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><code>React Hooks</code>æ˜¯React16.8çš„å¼ºå¤§ç‰¹æ€§ï¼Œæœ¬æ–‡ä¸»è¦è®°å½•ä¸ªäººå­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸€äº›ç†è§£ï¼Œç”±äº<a target="_blank" rel="noopener" href="https://react.docschina.org/docs/hooks-intro.html">Reactå®˜æ–¹æ–‡æ¡£</a>å¯¹å…¶åŸºæœ¬æ¦‚å¿µçš„æè¿°å·²ç»ååˆ†ç›´è§‚,æœ¬æ–‡ä¹Ÿä¸ä¼šå•°å—¦çš„å†<del>å¤åˆ¶</del>æè¿°ä¸€éå®ƒçš„æ¦‚å¿µã€‚å› æ­¤ï¼Œæœ¬æ–‡å¯èƒ½ä¸é€‚ç”¨äºæœªå­¦ä¹ è¿‡Hooksçš„äººç¾¤ã€‚æœ¬æ–‡çš„ç†è§£åŸºäºå®˜æ–¹ç»™çš„ä¾‹å­ï¼Œåç»­å¯èƒ½ä¼šå¢æ·»ä¸€äº›æ–°çš„è¡¥å……</p>
<h2 id="React-Hooksåšäº†ä»€ä¹ˆäº‹ï¼Ÿ"><a href="#React-Hooksåšäº†ä»€ä¹ˆäº‹ï¼Ÿ" class="headerlink" title="React Hooksåšäº†ä»€ä¹ˆäº‹ï¼Ÿ"></a>React Hooksåšäº†ä»€ä¹ˆäº‹ï¼Ÿ</h2><h3 id="å‘Šåˆ«class"><a href="#å‘Šåˆ«class" class="headerlink" title="å‘Šåˆ«class"></a>å‘Šåˆ«class</h3><p>Hook åœ¨ class å†…éƒ¨æ˜¯ä¸èµ·ä½œç”¨çš„ã€‚ä½†ä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥å–ä»£ classã€‚</p>
<p>å› ä¸ºæˆ‘æœ¬èº«å°±åœ¨<code>React Hooks</code>å‘å¸ƒä¹‹å‰ä½¿ç”¨è¿‡Reactï¼Œèƒ½æ˜æ˜¾æ„Ÿè§‰åˆ°å…¶å¸¦æ¥çš„å¥½å¤„ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨<code>Hooks</code>è¯ç”Ÿä¹‹å‰ï¼Œå‡½æ•°ç»„ä»¶è¢«ç§°ä¸º<code>æ— çŠ¶æ€ç»„ä»¶</code>ï¼Œæˆ‘ä»¬æ— æ³•åœ¨å‡½æ•°ç»„ä»¶ä¸­å®šä¹‰ç»„ä»¶çš„çŠ¶æ€ï¼Œå¹¶ä½¿ç”¨<code>this.setState</code>è¿™æ ·çš„æ–¹æ³•ã€‚</p>
<p>è€Œclassä¹Ÿæ˜¯å­¦ä¹ Reactçš„ä¸€å¤§éšœç¢ï¼Œå³ä½¿æˆ‘ä»¬èƒ½å¤Ÿå¾ˆå¥½çš„ç†è§£Javascriptä¸­<code>this</code>çš„å®šä¹‰ï¼Œä½†å¤æ‚çš„åœºæ™¯æœ‰æ—¶ä¹Ÿä¼šä¸ºæˆ‘ä»¬ç†è§£<code>this</code>çš„æŒ‡å‘å¸¦æ¥å›°æ‰°ã€‚è€Œä¸”æˆ‘ä»¬è¿˜ä¸èƒ½å¿˜è®°ç»‘å®šäº‹ä»¶å¤„ç†å™¨ã€‚</p>
<p><code>Hooks</code>è§£å†³äº†è¿™ä¸€é—®é¢˜ï¼Œæ¶ˆé™¤äº†<code>this</code>ï¼Œè®©æˆ‘ä»¬çš„ä»£ç æ›´å¥½ç†è§£ï¼Œè®©å‡½æ•°ç»„ä»¶èƒ½å¤Ÿä½¿ç”¨æ›´å¤šçš„Reactç‰¹æ€§ï¼Œä¹Ÿä¸éœ€è¦å†åŒºåˆ†classç»„ä»¶ä¸å‡½æ•°ç»„ä»¶çš„ä½¿ç”¨åœºæ™¯äº†ã€‚</p>
<blockquote>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒReactå¹¶æ²¡æœ‰å¼ƒç”¨classçš„æ‰“ç®—ï¼ŒHook å’Œç°æœ‰ä»£ç å¯ä»¥åŒæ—¶å·¥ä½œï¼Œæˆ‘ä»¬å¯ä»¥æ¸è¿›å¼åœ°ä½¿ç”¨ä»–ä»¬ã€‚Reactå›¢é˜Ÿä¹Ÿå°†ç»§ç»­ä¸ºclassç»„ä»¶æä¾›æ”¯æŒã€‚</p>
</blockquote>
<h3 id="æ¶ˆé™¤ç”Ÿå‘½å‘¨æœŸä¸­çš„å†—ä½™å’Œåˆ†ç¦»æ— å…³é€»è¾‘"><a href="#æ¶ˆé™¤ç”Ÿå‘½å‘¨æœŸä¸­çš„å†—ä½™å’Œåˆ†ç¦»æ— å…³é€»è¾‘" class="headerlink" title="æ¶ˆé™¤ç”Ÿå‘½å‘¨æœŸä¸­çš„å†—ä½™å’Œåˆ†ç¦»æ— å…³é€»è¾‘"></a>æ¶ˆé™¤ç”Ÿå‘½å‘¨æœŸä¸­çš„å†—ä½™å’Œåˆ†ç¦»æ— å…³é€»è¾‘</h3><p>é¦–å…ˆæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹<code>å‰¯ä½œç”¨</code>ï¼Œå¼•ç”¨å®˜æ–¹åŸè¯ï¼šæ•°æ®è·å–ï¼Œè®¾ç½®è®¢é˜…ä»¥åŠæ‰‹åŠ¨æ›´æ”¹ React ç»„ä»¶ä¸­çš„ DOM éƒ½å±äºå‰¯ä½œç”¨ã€‚ä¸ç®¡ä½ çŸ¥ä¸çŸ¥é“è¿™äº›æ“ä½œï¼Œæˆ–æ˜¯â€œå‰¯ä½œç”¨â€è¿™ä¸ªåå­—ï¼Œåº”è¯¥éƒ½åœ¨ç»„ä»¶ä¸­ä½¿ç”¨è¿‡å®ƒä»¬ã€‚</p>
<p><code>å‰¯ä½œç”¨</code>è¿™ä¸ªæ¦‚å¿µå…¶å®å¹¶ä¸æ˜¯æ¥è‡ªReactï¼Œè®²åˆ°å‰¯ä½œç”¨ï¼Œæˆ‘ä»¬ä¸å¾—ä¸æå¦ä¸€ä¸ªæ¦‚å¿µï¼š<code>çº¯å‡½æ•°</code>ã€‚ç®€å•æ¥è¯´ï¼Œçº¯å‡½æ•°å°±æ˜¯ï¼Œé€šè¿‡ç¡®å®šçš„è¾“å…¥ï¼Œäº§ç”Ÿç¡®å®šçš„è¾“å‡ºï¼Œåƒæˆ‘ä»¬ä¸­å­¦æ—¶æœŸæ•°å­¦ä¸­ç”¨çš„å‡½æ•°ï¼Œå°±æ˜¯çº¯å‡½æ•°ã€‚<strong>æ•°æ®è·å–ï¼Œè®¾ç½®è®¢é˜…ä»¥åŠæ‰‹åŠ¨æ›´æ”¹ React ç»„ä»¶ä¸­çš„ DOM</strong>ï¼Œè¿™äº›å‰¯ä½œç”¨å¯èƒ½ä¼šäº§ç”Ÿä¸åŒçš„ç»“æœï¼Œæ”¹å˜ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œæœ‰äº†è¿™äº›ï¼Œå‡½æ•°å°±ä¸æ˜¯çº¯å‡½æ•°äº†ã€‚</p>
<p>æ›¾ç»ï¼Œæˆ‘ä»¬ç»å¸¸åœ¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ä½¿ç”¨å‰¯ä½œç”¨ï¼Œæ¯”å¦‚åœ¨<code>componentDidMount</code>ä¸­å‘èµ·è¯·æ±‚è·å–æ•°æ®</p>
<p>ä»¥ä¸‹ä¾‹å­ä¸ºç»„ä»¶æ¯æ¬¡æ¸²æŸ“åæ›´æ–°é¡µé¢titleï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span><br>    &#125;;<br>  &#125;<br><br>  <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">`You clicked <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.state.count&#125;</span> times`</span>;<br>  &#125;<br>  <span class="hljs-title function_">componentDidUpdate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">`You clicked <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.state.count&#125;</span> times`</span>;<br>  &#125;<br><br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You clicked &#123;this.state.count&#125; times<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> this.setState(&#123; count: this.state.count + 1 &#125;)&#125;&gt;</span><br><span class="language-xml">          Click me</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ç¼–å†™é‡å¤çš„ä»£ç ï¼Œå› ä¸ºæœ‰äº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ç»„ä»¶æ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡ŒæŸä¸ªæ“ä½œï¼Œä½†Reactå¹¶æ²¡æœ‰æä¾›è¿™æ ·çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>useEffect</code>å¤„ç†è¿™ä¸ªé—®é¢˜</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Example</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">`You clicked <span class="hljs-subst">$&#123;count&#125;</span> times`</span>;<br>  &#125;);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You clicked &#123;count&#125; times<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;</span><br><span class="language-xml">        Click me</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥æŠŠuseEffect Hookçœ‹åšcomponentDidMountï¼ŒcomponentDidUpdateå’ŒcomponentWillUnmountè¿™ä¸‰ä¸ªå‡½æ•°çš„ç»„åˆã€‚</p>
<p>å¯¹ï¼Œä½ å‘ç°é—®é¢˜äº†ï¼Œä¸Šè¿°ä¾‹å­ä¸­æˆ‘ä»¬<code>useEffect</code>çš„å†…å®¹ï¼Œåªæ˜¯åœ¨æ¸²æŸ“åæ‰§è¡Œçš„,é‚£ä¹ˆæ€ä¹ˆå®ç°<code>componentWillUnmount</code>å‘¢ï¼Ÿ</p>
<p>æœ‰ä¸€äº›å‰¯ä½œç”¨æ˜¯éœ€è¦æ¸…é™¤çš„ã€‚ä¾‹å¦‚è®¢é˜…å¤–éƒ¨æ•°æ®æºã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ¸…é™¤å·¥ä½œæ˜¯éå¸¸é‡è¦çš„ï¼Œå¯ä»¥é˜²æ­¢å¼•èµ·å†…å­˜æ³„éœ²ã€‚</p>
<p>çœ‹ä»¥ä¸‹ä¾‹å­,å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªChatAPIæ¨¡å—ï¼Œå®ƒå…è®¸æˆ‘ä»¬è®¢é˜…å¥½å‹çš„åœ¨çº¿çŠ¶æ€ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FriendStatus</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123; <span class="hljs-attr">isOnline</span>: <span class="hljs-literal">null</span> &#125;;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleStatusChange</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleStatusChange</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);<br>  &#125;<br><br>  <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">ChatAPI</span>.<span class="hljs-title function_">subscribeToFriendStatus</span>(<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">friend</span>.<span class="hljs-property">id</span>,<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleStatusChange</span><br>    );<br>  &#125;<br>  <span class="hljs-title function_">componentWillUnmount</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">ChatAPI</span>.<span class="hljs-title function_">unsubscribeFromFriendStatus</span>(<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">friend</span>.<span class="hljs-property">id</span>,<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleStatusChange</span><br>    );<br>  &#125;<br>  <span class="hljs-title function_">handleStatusChange</span>(<span class="hljs-params">status</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>      <span class="hljs-attr">isOnline</span>: status.<span class="hljs-property">isOnline</span><br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">isOnline</span> === <span class="hljs-literal">null</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Loading...&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">isOnline</span> ? <span class="hljs-string">&#x27;Online&#x27;</span> : <span class="hljs-string">&#x27;Offline&#x27;</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä½ ä¼šæ³¨æ„åˆ° componentDidMount å’Œ componentWillUnmount ä¹‹é—´ç›¸äº’å¯¹åº”ã€‚ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°è¿«ä½¿æˆ‘ä»¬æ‹†åˆ†è¿™äº›é€»è¾‘ä»£ç ï¼Œå³ä½¿è¿™ä¸¤éƒ¨åˆ†ä»£ç éƒ½ä½œç”¨äºç›¸åŒçš„å‰¯ä½œç”¨ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨<code>useEffect</code>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">FriendStatus</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-keyword">const</span> [isOnline, setIsOnline] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleStatusChange</span>(<span class="hljs-params">status</span>) &#123;<br>      <span class="hljs-title function_">setIsOnline</span>(status.<span class="hljs-property">isOnline</span>);<br>    &#125;<br>    <span class="hljs-title class_">ChatAPI</span>.<span class="hljs-title function_">subscribeToFriendStatus</span>(props.<span class="hljs-property">friend</span>.<span class="hljs-property">id</span>, handleStatusChange);<br>    <span class="hljs-comment">// Specify how to clean up after this effect:</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">cleanup</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title class_">ChatAPI</span>.<span class="hljs-title function_">unsubscribeFromFriendStatus</span>(props.<span class="hljs-property">friend</span>.<span class="hljs-property">id</span>, handleStatusChange);<br>    &#125;;<br>  &#125;);<br><br>  <span class="hljs-keyword">if</span> (isOnline === <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Loading...&#x27;</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> isOnline ? <span class="hljs-string">&#x27;Online&#x27;</span> : <span class="hljs-string">&#x27;Offline&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>useEffect</code>èƒ½å¤Ÿè¿”å›ä¸€ä¸ªæ¸…é™¤å‡½æ•°ï¼Œè¿™æ˜¯å¯é€‰çš„æœºåˆ¶ã€‚å¦‚æ­¤å¯ä»¥å°†æ·»åŠ å’Œç§»é™¤è®¢é˜…çš„é€»è¾‘æ”¾åœ¨ä¸€èµ·ã€‚å®ƒä»¬éƒ½å±äº effect çš„ä¸€éƒ¨åˆ†ã€‚</p>
<blockquote>
<p>ä¸componentWillUnmountä¸åŒçš„æ˜¯ï¼ŒuseEffectè¿”å›çš„æ¸…æ¥šå‡½æ•°åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶éƒ½ä¼šæ‰§è¡Œ</p>
</blockquote>
<p>ä»¥å‰åœ¨classä¸­ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ—¶è¿˜ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œä»¥ä»¥ä¸Šçš„ä¾‹å­ä¸¾ä¾‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FriendStatusWithCounter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123; <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">isOnline</span>: <span class="hljs-literal">null</span> &#125;;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleStatusChange</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleStatusChange</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);<br>  &#125;<br><br>  <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">`You clicked <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.state.count&#125;</span> times`</span>;<br>    <span class="hljs-title class_">ChatAPI</span>.<span class="hljs-title function_">subscribeToFriendStatus</span>(<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">friend</span>.<span class="hljs-property">id</span>,<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleStatusChange</span><br>    );<br>  &#125;<br><br>  <span class="hljs-title function_">componentDidUpdate</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">`You clicked <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.state.count&#125;</span> times`</span>;<br>  &#125;<br><br>  <span class="hljs-title function_">componentWillUnmount</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title class_">ChatAPI</span>.<span class="hljs-title function_">unsubscribeFromFriendStatus</span>(<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">friend</span>.<span class="hljs-property">id</span>,<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleStatusChange</span><br>    );<br>  &#125;<br><br>  <span class="hljs-title function_">handleStatusChange</span>(<span class="hljs-params">status</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>      <span class="hljs-attr">isOnline</span>: status.<span class="hljs-property">isOnline</span><br>    &#125;);<br>  &#125;<br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></figure>
<p>çœ‹ï¼Œå½“æˆ‘ä»¬å¦‚æœåˆéœ€è¦è®¾ç½®é¡µé¢çš„titleï¼Œä¹Ÿéœ€è¦è®¢é˜…å¥½å‹çš„åœ¨çº¿çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬åªèƒ½åƒä»¥ä¸Šé‚£æ ·å†™ï¼Œè¿™æ ·é™¤äº†å°†ç›¸å…³é€»è¾‘åˆ†å‰²åˆ°ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä»¥å¤–ï¼Œ<code>componentDidMount</code>ä¸­åŒæ—¶åŒ…å«äº†ä¸¤ä¸ªä¸åŒåŠŸèƒ½çš„ä»£ç ã€‚</p>
<p>é‚£ä¹ˆHookå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå°±åƒä½ å¯ä»¥ä½¿ç”¨å¤šä¸ªstateçš„Hookä¸€æ ·ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ªeffectã€‚è¿™ä¼šå°†ä¸ç›¸å…³é€»è¾‘åˆ†ç¦»åˆ°ä¸åŒçš„ effectä¸­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">FriendStatusWithCounter</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">`You clicked <span class="hljs-subst">$&#123;count&#125;</span> times`</span>;<br>  &#125;);<br><br>  <span class="hljs-keyword">const</span> [isOnline, setIsOnline] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleStatusChange</span>(<span class="hljs-params">status</span>) &#123;<br>      <span class="hljs-title function_">setIsOnline</span>(status.<span class="hljs-property">isOnline</span>);<br>    &#125;<br><br>    <span class="hljs-title class_">ChatAPI</span>.<span class="hljs-title function_">subscribeToFriendStatus</span>(props.<span class="hljs-property">friend</span>.<span class="hljs-property">id</span>, handleStatusChange);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-title class_">ChatAPI</span>.<span class="hljs-title function_">unsubscribeFromFriendStatus</span>(props.<span class="hljs-property">friend</span>.<span class="hljs-property">id</span>, handleStatusChange);<br>    &#125;;<br>  &#125;);<br>  <span class="hljs-comment">// ...</span><br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>Hookå…è®¸æˆ‘ä»¬æŒ‰ç…§ä»£ç çš„ç”¨é€”åˆ†ç¦»ä»–ä»¬ï¼Œè€Œä¸æ˜¯åƒç”Ÿå‘½å‘¨æœŸå‡½æ•°é‚£æ ·ã€‚Reactå°†æŒ‰ç…§effectå£°æ˜çš„é¡ºåºä¾æ¬¡è°ƒç”¨ç»„ä»¶ä¸­çš„æ¯ä¸€ä¸ªeffectã€‚</p>
<h3 id="å¤ç”¨çŠ¶æ€é€»è¾‘"><a href="#å¤ç”¨çŠ¶æ€é€»è¾‘" class="headerlink" title="å¤ç”¨çŠ¶æ€é€»è¾‘"></a>å¤ç”¨çŠ¶æ€é€»è¾‘</h3><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬å°è£…äº†ä¸€ä¸ªå¥½å‹åœ¨çº¿çŠ¶æ€çš„Hook,å®ƒå°† friendID ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›è¯¥å¥½å‹æ˜¯å¦åœ¨çº¿</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useFriendStatus</span>(<span class="hljs-params">friendID</span>) &#123;<br>  <span class="hljs-keyword">const</span> [isOnline, setIsOnline] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleStatusChange</span>(<span class="hljs-params">status</span>) &#123;<br>    <span class="hljs-title function_">setIsOnline</span>(status.<span class="hljs-property">isOnline</span>);<br>  &#125;<br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title class_">ChatAPI</span>.<span class="hljs-title function_">subscribeToFriendStatus</span>(friendID, handleStatusChange);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-title class_">ChatAPI</span>.<span class="hljs-title function_">unsubscribeFromFriendStatus</span>(friendID, handleStatusChange);<br>    &#125;;<br>  &#125;);<br><br>  <span class="hljs-keyword">return</span> isOnline;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ä¸¤ä¸ªç»„ä»¶ä¸­ä½¿ç”¨å®ƒ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">FriendStatus</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-keyword">const</span> isOnline = <span class="hljs-title function_">useFriendStatus</span>(props.<span class="hljs-property">friend</span>.<span class="hljs-property">id</span>);<br><br>  <span class="hljs-keyword">if</span> (isOnline === <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Loading...&#x27;</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> isOnline ? <span class="hljs-string">&#x27;Online&#x27;</span> : <span class="hljs-string">&#x27;Offline&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">FriendListItem</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-keyword">const</span> isOnline = <span class="hljs-title function_">useFriendStatus</span>(props.<span class="hljs-property">friend</span>.<span class="hljs-property">id</span>);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">color:</span> <span class="hljs-attr">isOnline</span> ? &#x27;<span class="hljs-attr">green</span>&#x27; <span class="hljs-attr">:</span> &#x27;<span class="hljs-attr">black</span>&#x27; &#125;&#125;&gt;</span></span><br><span class="language-xml">      &#123;props.friend.name&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>
<p>é¦–å…ˆè¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªä¸¤ä¸ªç»„ä»¶çš„<code>state</code>æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œ<code>Hook</code><strong>åªå¤ç”¨stateçš„é€»è¾‘ï¼Œä¸å¤ç”¨stateæœ¬èº«</strong></p>
<p>ä¹Ÿæ˜¯è¿™ä¸ªä¾‹å­ï¼Œè®©æˆ‘æ›´å¥½çš„ç†è§£äº†<code>Hook</code>åå­—çš„ç”±æ¥ï¼Œæ­£å¦‚å®ƒçš„ä¸­æ–‡ç¿»è¯‘<code>é’©å­</code>,å®ƒèƒ½å¤Ÿå°†ä¸€äº›å…¬ç”¨çš„é€»è¾‘æŠ½ç¦»å‡ºç»„ä»¶ï¼ˆæˆ–è€…è¯´ä¸€äº›ç‰¹æ€§ï¼Œæ¯”å¦‚<code>useState</code>ï¼‰ï¼Œä¸ç»„ä»¶æœ¬èº«è§£è€¦ï¼Œåœ¨éœ€è¦ä½¿ç”¨å®ƒçš„ç»„ä»¶é‡Œé’©å…¥å®ƒã€‚</p>
<h2 id="Hookè§„åˆ™"><a href="#Hookè§„åˆ™" class="headerlink" title="Hookè§„åˆ™"></a>Hookè§„åˆ™</h2><p>ä»¥ä¸‹æ‘˜è‡ªå®˜æ–¹æ–‡æ¡£åŸè¯</p>
<h3 id="åªåœ¨æœ€é¡¶å±‚ä½¿ç”¨-Hook"><a href="#åªåœ¨æœ€é¡¶å±‚ä½¿ç”¨-Hook" class="headerlink" title="åªåœ¨æœ€é¡¶å±‚ä½¿ç”¨ Hook"></a>åªåœ¨æœ€é¡¶å±‚ä½¿ç”¨ Hook</h3><p>ä¸è¦åœ¨å¾ªç¯ï¼Œæ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨<code>Hookï¼Œ</code>ï¼Œç¡®ä¿æ€»æ˜¯åœ¨ä½ çš„Reactå‡½æ•°çš„æœ€é¡¶å±‚è°ƒç”¨ä»–ä»¬ã€‚éµå®ˆè¿™æ¡è§„åˆ™ï¼Œä½ å°±èƒ½ç¡®ä¿<code>Hook</code>åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“ä¸­éƒ½æŒ‰ç…§åŒæ ·çš„é¡ºåºè¢«è°ƒç”¨ã€‚è¿™è®©Reactèƒ½å¤Ÿåœ¨å¤šæ¬¡çš„<code>useState</code>å’Œ<code>useEffect</code>è°ƒç”¨ä¹‹é—´ä¿æŒ<code>Hook</code>çŠ¶æ€çš„æ­£ç¡®ã€‚</p>
<p>è‡³äºä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼ŒReactæ–‡æ¡£ä¸­ä¹Ÿç»™äº†ç›¸å…³çš„åŸå› :<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// 1. Use the name state variable</span><br>  <span class="hljs-keyword">const</span> [name, setName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;Mary&#x27;</span>);<br><br>  <span class="hljs-comment">// 2. Use an effect for persisting the form</span><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">persistForm</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;formData&#x27;</span>, name);<br>  &#125;);<br><br>  <span class="hljs-comment">// 3. Use the surname state variable</span><br>  <span class="hljs-keyword">const</span> [surname, setSurname] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;Poppins&#x27;</span>);<br><br>  <span class="hljs-comment">// 4. Use an effect for updating the title</span><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateTitle</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = name + <span class="hljs-string">&#x27; &#x27;</span> + surname;<br>  &#125;);<br><br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// ------------</span><br><span class="hljs-comment">// é¦–æ¬¡æ¸²æŸ“</span><br><span class="hljs-comment">// ------------</span><br><span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;Mary&#x27;</span>)           <span class="hljs-comment">// 1. ä½¿ç”¨ &#x27;Mary&#x27; åˆå§‹åŒ–å˜é‡åä¸º name çš„ state</span><br><span class="hljs-title function_">useEffect</span>(persistForm)     <span class="hljs-comment">// 2. æ·»åŠ  effect ä»¥ä¿å­˜ form æ“ä½œ</span><br><span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;Poppins&#x27;</span>)        <span class="hljs-comment">// 3. ä½¿ç”¨ &#x27;Poppins&#x27; åˆå§‹åŒ–å˜é‡åä¸º surname çš„ state</span><br><span class="hljs-title function_">useEffect</span>(updateTitle)     <span class="hljs-comment">// 4. æ·»åŠ  effect ä»¥æ›´æ–°æ ‡é¢˜</span><br><br><span class="hljs-comment">// -------------</span><br><span class="hljs-comment">// äºŒæ¬¡æ¸²æŸ“</span><br><span class="hljs-comment">// -------------</span><br><span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;Mary&#x27;</span>)           <span class="hljs-comment">// 1. è¯»å–å˜é‡åä¸º name çš„ stateï¼ˆå‚æ•°è¢«å¿½ç•¥ï¼‰</span><br><span class="hljs-title function_">useEffect</span>(persistForm)     <span class="hljs-comment">// 2. æ›¿æ¢ä¿å­˜ form çš„ effect</span><br><span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;Poppins&#x27;</span>)        <span class="hljs-comment">// 3. è¯»å–å˜é‡åä¸º surname çš„ stateï¼ˆå‚æ•°è¢«å¿½ç•¥ï¼‰</span><br><span class="hljs-title function_">useEffect</span>(updateTitle)     <span class="hljs-comment">// 4. æ›¿æ¢æ›´æ–°æ ‡é¢˜çš„ effect</span><br><br><span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></figure><br>æ¯”å¦‚æˆ‘ä»¬åœ¨ç»„ä»¶ä¸­å®šä¹‰äº†å››ä¸ª<code>Hook</code>ï¼Œå¦‚æœåœ¨é¡¶å±‚è°ƒç”¨çš„è¯ï¼Œæ•ˆæœå¦‚ä¸Šæ‰€ç¤ºã€‚</p>
<p>æˆ‘ä»¬æ³¨æ„åˆ°ï¼ŒäºŒæ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼Œ<code>useState</code>è¯»å–çš„æ˜¯æ”¹å˜åçš„çŠ¶æ€ï¼ˆå¦‚æœæœªæ”¹å˜ï¼Œå°±æ˜¯ä¹‹å‰çš„çŠ¶æ€ï¼‰ï¼Œè¿™æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</p>
<p><strong>åªè¦ Hook çš„è°ƒç”¨é¡ºåºåœ¨å¤šæ¬¡æ¸²æŸ“ä¹‹é—´ä¿æŒä¸€è‡´ï¼ŒReact å°±èƒ½æ­£ç¡®åœ°å°†å†…éƒ¨ state å’Œå¯¹åº”çš„ Hook è¿›è¡Œå…³è”ã€‚</strong></p>
<p>å¦‚æœæˆ‘ä»¬å°†ä¸€ä¸ª<code>Hook</code>çš„è°ƒç”¨æ”¾åˆ°ä¸€ä¸ªæ¡ä»¶è¯­å¥ä¸­</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// åœ¨æ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨ Hook è¿åç¬¬ä¸€æ¡è§„åˆ™</span><br><span class="hljs-keyword">if</span> (name !== <span class="hljs-string">&#x27;&#x27;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">persistForm</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;formData&#x27;</span>, name);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">useState</span><span class="hljs-params">(<span class="hljs-string">&#x27;Mary&#x27;</span>)</span></span>           <span class="hljs-comment">// 1. è¯»å–å˜é‡åä¸º name çš„ stateï¼ˆå‚æ•°è¢«å¿½ç•¥ï¼‰</span><br><span class="hljs-comment">// useEffect(persistForm)  // æ­¤ Hook è¢«å¿½ç•¥ï¼</span><br><span class="hljs-function"><span class="hljs-title">useState</span><span class="hljs-params">(<span class="hljs-string">&#x27;Poppins&#x27;</span>)</span></span>        <span class="hljs-comment">// 2 ï¼ˆä¹‹å‰ä¸º 3ï¼‰ã€‚è¯»å–å˜é‡åä¸º surname çš„ state å¤±è´¥, å®ƒå’Œä¸Šä¸€æ¬¡çš„useEffect(persistForm) å¯¹åº”äº†</span><br><span class="hljs-function"><span class="hljs-title">useEffect</span><span class="hljs-params">(updateTitle)</span></span>     <span class="hljs-comment">// 3 ï¼ˆä¹‹å‰ä¸º 4ï¼‰ã€‚æ›¿æ¢æ›´æ–°æ ‡é¢˜çš„ effect å¤±è´¥</span><br></code></pre></td></tr></table></figure>
<p><strong>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆHookéœ€è¦åœ¨æˆ‘ä»¬ç»„ä»¶çš„æœ€é¡¶å±‚è°ƒç”¨ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦æœ‰æ¡ä»¶åœ°æ‰§è¡Œä¸€ä¸ªeffectï¼Œå¯ä»¥å°†åˆ¤æ–­æ”¾åˆ°Hookçš„å†…éƒ¨ï¼š</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">persistForm</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// ğŸ‘ å°†æ¡ä»¶åˆ¤æ–­æ”¾ç½®åœ¨ effect ä¸­</span><br>  <span class="hljs-keyword">if</span> (name !== <span class="hljs-string">&#x27;&#x27;</span>) &#123;<br>    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;formData&#x27;</span>, name);<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>
<h3 id="åªåœ¨-React-å‡½æ•°ä¸­è°ƒç”¨-Hook"><a href="#åªåœ¨-React-å‡½æ•°ä¸­è°ƒç”¨-Hook" class="headerlink" title="åªåœ¨ React å‡½æ•°ä¸­è°ƒç”¨ Hook"></a>åªåœ¨ React å‡½æ•°ä¸­è°ƒç”¨ Hook</h3><p>ä¸è¦åœ¨æ™®é€šçš„ JavaScript å‡½æ•°ä¸­è°ƒç”¨ Hookã€‚ä½ å¯ä»¥ï¼š</p>
<ul>
<li>åœ¨Reactçš„å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨<code>Hook</code></li>
<li>åœ¨<code>è‡ªå®šä¹‰Hook</code>ä¸­è°ƒç”¨å…¶ä»–<code>Hook</code></li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%89%8D%E7%AB%AF/">å‰ç«¯</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Javascript/">Javascript</a>
                    
                      <a class="hover-with-bg" href="/tags/React/">React</a>
                    
                      <a class="hover-with-bg" href="/tags/React-Hooks/">React Hooks</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/04/08/map(parseInt)%E7%9A%84%E9%97%AE%E9%A2%98/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">arr.map(parseInt)çš„é—®é¢˜</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/04/04/%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%8B%E4%BB%B6%E5%A7%94%E6%89%98%EF%BC%88%E4%BB%A3%E7%90%86%EF%BC%89%EF%BC%9F/">
                        <span class="hidden-mobile">ä»€ä¹ˆæ˜¯äº‹ä»¶å§”æ‰˜ï¼ˆä»£ç†ï¼‰ï¼Ÿ</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  
  <!-- å¤‡æ¡ˆä¿¡æ¯ -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        æµ™ICPå¤‡2022010354å·-1
      </a>
    </span>
    
  </div>


  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>



<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
